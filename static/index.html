<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Finance App - Test Frontend</title>
</head>
<body>
<h2>Реєстрація</h2>
<form id="register-form">
  <input type="text" id="reg-username" placeholder="Username" required />
  <input type="email" id="reg-email" placeholder="Email" required />
  <input type="password" id="reg-password" placeholder="Password" required />
  <button type="submit">Register</button>
</form>

<h2>Логін</h2>
<form id="login-form">
  <input type="text" id="login-username" placeholder="Username" required />
  <input type="password" id="login-password" placeholder="Password" required />
  <button type="submit">Login</button>
</form>

<h3>Токен:</h3>
<pre id="token-display"></pre>

<script>
const API_URL = 'http://127.0.0.1:8000';

document.getElementById('register-form').addEventListener('submit', async e => {
  e.preventDefault();
  const username = document.getElementById('reg-username').value;
  const email = document.getElementById('reg-email').value;
  const password = document.getElementById('reg-password').value;

  const res = await fetch(`${API_URL}/users/register`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, email, password })
  });

  if (res.ok) alert('Реєстрація успішна!');
  else alert('Помилка реєстрації');
});

document.getElementById('login-form').addEventListener('submit', async e => {
  e.preventDefault();
  const username = document.getElementById('login-username').value;
  const password = document.getElementById('login-password').value;

  const formData = new URLSearchParams();
  formData.append('username', username);
  formData.append('password', password);

  const res = await fetch(`${API_URL}/users/login`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: formData
  });

    if (res.ok) {
      const data = await res.json();
      localStorage.setItem('access_token', data.access_token); // зберігаємо токен
      window.location.href = "/static/dashboard.html"; // редірект
      } else {
      alert('Помилка логіну');
      }

});
</script>
</body>
</html>
